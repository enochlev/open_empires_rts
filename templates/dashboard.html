<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <style>
       body {
            font-family: Arial, sans-serif;
            background-image: url('{{ url_for('static', filename='backgroundImage.png') }}');
            background-size: 100% auto; /* Cover the width of the screen */
            background-repeat: no-repeat; /* No repeat for the background image */
            background-attachment: fixed; /* Keep the background fixed during scrolling */
            background-color: #99d9ea; /* Set the background color */
            color: #001;
        }

        /* Add some basic styling */
        form { margin-bottom: 20px; }
        input, button { margin-right: 10px; }
        .progress-container {
            width: 300pt; 
            background-color: #ddd; 
        }
        .progress-bar {
            height: 20px; 
            background-color: #4CAF50; 
            text-align: center; 
            line-height: 20px; 
            color: white; 
        }
        .quest-box {
            border: 1px solid;
            margin: 5px;
            padding: 5px;
            width: 300pt;
        }
        .quest-completed {
            background-color: green;
        }
        .quest-not-completed {
            background-color: white;
        }
        #game-container {
            position: relative;
            width: 1500px;
            height: 1000px;
            background-size: cover;
        }
        .building {
            position: absolute;
        }
    </style>
    <!-- <meta http-equiv="refresh" content="30"> -->

</head>
<body>
    {% if message %}
      <div style="margin: 10px; padding: 10px; background-color: #f0f0f0; border: 1px solid #ddd;">
        {{ message }}
      </div>
    {% endif %}

    <a href="{{ url_for('empire_game.index') }}" style="display: inline-block; padding: 10px 20px; margin: 10px; background-color: #f0f0f0; color: black; border: 1px solid #ddd; text-decoration: none; border-radius: 4px;">Back to Home</a>
    <!-- Refresh button -->
    <a href="{{ url_for('empire_game.dashboard') }}" style="display: inline-block; padding: 10px 20px; margin: 10px; background-color: #f0f0f0; color: black; border: 1px solid #ddd; text-decoration: none; border-radius: 4px;">Refresh</a>

    <h1>üéÆ Dashboard for {{ player_data["Player Name"] }}</h1>

    <!-- Resources section -->
    <h2>üí∞ Resources</h2>
    <ul>
      <li>üíµ Money: {{ "%.0f"|format(player_data.Resources.money) }}</li>
      <li>ü™® Stone: {{ "%.0f"|format(player_data.Resources.stone) }}</li>
      <li>üîó Iron: {{ "%.0f"|format(player_data.Resources.iron) }}</li>
      <li>üü° Gold: {{ "%.0f"|format(player_data.Resources.gold) }}</li>
      <li>üíé Diamond: {{ "%.0f"|format(player_data.Resources.diamond) }}</li>
      <li>ü™µ Wood: {{ "%.0f"|format(player_data.Resources.wood) }}</li>
      <li>üåæ Hay: {{ "%.0f"|format(player_data.Resources.hay) }}</li>
    </ul>

    <!-- Buildings section -->
    <h2>üè∞ Castle: Level {{ player_data.Buildings.levels.Castle }}</h2>
    <h5>{{ game_config.Buildings.Castle.description }}</h5>
    <h3>üè† Buildings</h3>
    <ul>
      {% for building, details in game_config.Buildings.items() %}
        {% if player_data.Buildings.levels[building] > 0 %}
          <li>{{ building }}: {{ player_data.Buildings.levels[building] }}</li>
        {% endif %}
      {% endfor %}
    </ul>

    <!-- Upgrade Building Form -->
    <form method="POST">
      <select name="building_type">
        {% for building, details in game_config.Buildings.items() %}
          {% if player_data.Buildings.levels[building] >= details.max_level %}
            <option value="{{ building }}" disabled>{{ building }} - Max Level</option>
          {% else %}
            {% set upgrade_cost = [] %}
            {% for resource, cost in details.cost.items() %}
              {% set new_cost = cost * (game_config.game_speed_and_multiplier.building_upgrade_cost_multiplier ** player_data.Buildings.levels[building]) %}
              {% set rounded_cost = new_cost | round(method='ceil') | int %}
              {% set _ = upgrade_cost.append(resource ~ ": " ~ rounded_cost) %}
            {% endfor %}
            <option value="{{ building }}">
              {{ building }} - Upgrade to Level {{ player_data.Buildings.levels[building] + 1 }}:
              {{ upgrade_cost | join(", ") }}
            </option>
          {% endif %}
        {% endfor %}
      </select>
      <button name="purchase_building" type="submit">Upgrade Building</button>
    </form>

    <!-- Ongoing Building Upgrade Progress -->
    {% for building, details in game_config.Buildings.items() %}
      {% set ongoing = player_data.Buildings.ongoing_builds %}
      {% if ongoing and ongoing.building == building %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
          <div class="progress-bar" style="background-color: green; width: {{ ongoing.progress * 100 }}%; height: 100%; position: absolute;"></div>
          <div style="position: absolute; width: 100%; text-align: center; color: white;">
            {{ building }} {{ "%.0f"|format(ongoing.progress * 100) }}%
          </div>
        </div>
        <br>
      {% endif %}
    {% endfor %}

    <!-- Units Section ‚Äì Citizens (Village House.Citizen) -->
    <h3>üë®‚Äçüåæ Citizens: {{ player_data.Units.count["Village House.Citizen"] }}</h3>
    <p>Cost:
      {% for resource, cost in game_config.Units["Village House.Citizen"].cost.items() %}
        {{ resource }}: {{ "%.0f"|format(cost) }}{% if not loop.last %}, {% endif %}
      {% endfor %}
    </p>
    <div style="display: flex; justify-content: left;">
      <form method="POST" style="margin-left: 10px;">
        <input type="hidden" name="unit_type" value="Village House.Citizen">
        <button name="purchase_unit" type="submit">Purchase Citizen</button>
      </form>
      <form method="POST">
        <input type="hidden" name="unit_type" value="Village House.Citizen">
        <button name="remove_unit_from_queue" type="submit">Remove Citizen from Queue</button>
      </form>
    </div>

    <!-- Recruitment Progress for Citizens -->
    {% set citizen_ongoing = 0 %}
    {% for rec in player_data.Units.ongoing_recruitments %}
      {% if rec.unit == "Village House.Citizen" %}
        {% set citizen_ongoing = rec.progress %}
      {% endif %}
    {% endfor %}
    {% set citizen_queued = 0 %}
    {% for rec in player_data.Units.queued_recruitments %}
      {% if rec.unit == "Village House.Citizen" %}
        {% set citizen_queued = citizen_queued + 1 %}
      {% endif %}
    {% endfor %}
    <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
      <div class="progress-bar" style="background-color: green; width: {{ citizen_ongoing|default(0, true) * 100 }}%; height: 100%; position: absolute;"></div>
      <div style="position: absolute; width: 100%; text-align: center; color: white;">
        {{ citizen_queued + (citizen_ongoing is not none and 1 or 0) }} Citizens ‚Äì {{ "%.0f"|format(citizen_ongoing|default(0) * 100) }}%
      </div>
    </div>

    <!-- Smithy / Unit Upgrades -->
    {% if player_data.Buildings.levels.Smithy > 0 %}
      <h2>üõ† Smithy: Level {{ player_data.Buildings.levels.Smithy }}</h2>
      <h5>{{ game_config.Buildings.Smithy.description }}</h5>
      <h3>üó° Upgrades</h3>
      <form method="POST">
        <select name="unit_type">
          {% for unit, details in game_config.Units.items() %}
            {% if player_data.Units.levels[unit] >= details.max_level %}
              <option value="{{ unit }}" disabled>{{ unit }} - Max Level</option>
            {% else %}
              {% set upgrade_cost = [] %}
              {% for resource, cost in details.upgrade_cost.items() %}
                {% set new_cost = cost * (game_config.game_speed_and_multiplier.unit_upgrade_cost_multiplier ** player_data.Units.levels[unit]) %}
                {% set rounded_cost = new_cost | round(method='ceil') | int %}
                {% set _ = upgrade_cost.append(resource ~ ": " ~ rounded_cost) %}
              {% endfor %}
              <option value="{{ unit }}">
                {{ unit }} - Upgrade to Level {{ player_data.Units.levels[unit] + 1 }}: {{ upgrade_cost | join(", ") }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <button name="upgrade_unit" type="submit">Upgrade Unit</button>
      </form>
      <!-- Ongoing unit upgrade progress (filtering the single upgrade in progress) -->
      {% if player_data.Units.ongoing_upgrades %}
        {% set ongoing_upg = player_data.Units.ongoing_upgrades %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
          <div class="progress-bar" style="background-color: green; width: {{ ongoing_upg.progress * 100 }}%; height: 100%; position: absolute;"></div>
          <div style="position: absolute; width: 100%; text-align: center; color: white;">
            Upgrading {{ ongoing_upg.unit }} ‚Äì {{ "%.0f"|format(ongoing_upg.progress * 100) }}%
          </div>
        </div>
      {% endif %}
    {% endif %}

    <!-- Barracks Training Section -->
    {% if player_data.Buildings.levels.Barracks > 0 %}
      <h2>üè∞ Barracks: Level {{ player_data.Buildings.levels.Barracks }}</h2>
      <h5>{{ game_config.Buildings.Barracks.description }}</h5>
      <p>Soldiers: {{ player_data.Units.count["Barracks.Soldier"] }}</p>
      <p>Archers: {{ player_data.Units.count["Barracks.Archer"] }}</p>
      <h3>üë®‚Äçüåæ Training</h3>
      <form method="POST">
        <select name="barracks_unit_type">
          {% for unit, details in game_config.Units.items() %}
            {% if details.building_source == "Barracks" %}
              {% set curr_level = player_data.Units.levels[unit] %}
              {% set upgrade_cost = [] %}
              {% for resource, cost in details.cost.items() %}
                {% set new_cost = cost * (game_config.game_speed_and_multiplier.unit_upgrade_cost_multiplier ** (curr_level - 1)) %}
                {% set rounded_cost = new_cost | round(method='ceil') | int %}
                {% set _ = upgrade_cost.append(resource ~ ": " ~ rounded_cost) %}
              {% endfor %}
              <option value="{{ unit }}">
                {{ unit }} - {{ upgrade_cost | join(", ") }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <button name="purchase_unit" type="submit">Purchase Unit</button>
      </form>
      {% for unit, details in game_config.Units.items() %}
        {% if details.building_source == "Barracks" %}
          {% set ongoing = None %}
          {% for rec in player_data.Units.ongoing_recruitments %}
            {% if rec.unit == unit %}{% set ongoing = rec.progress %}{% endif %}
          {% endfor %}
          {% set queued = 0 %}
          {% for rec in player_data.Units.queued_recruitments %}
            {% if rec.unit == unit %}{% set queued = queued + 1 %}{% endif %}
          {% endfor %}
          {% if ongoing is not none %}
            <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
              <div class="progress-bar" style="background-color: green; width: {{ ongoing * 100 }}%; height: 100%; position: absolute;"></div>
              <div style="position: absolute; width: 100%; text-align: center; color: white;">
                {{ queued + 1 }} {{ unit }} ‚Äì {{ "%.0f"|format(ongoing * 100) }}%
              </div>
            </div>
            <br>
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}

    <!-- Stables Training Section -->
    {% if player_data.Buildings.levels.Stables > 0 %}
      <h2>üè∞ Stables: Level {{ player_data.Buildings.levels.Stables }}</h2>
      <h5>{{ game_config.Buildings.Stables.description }}</h5>
      <p>Calvary: {{ player_data.Units.count["Stables.Calvary"] }}</p>
      <h3>üë®‚Äçüåæ Training</h3>
      <form method="POST">
        <select name="unit_type">
          {% for unit, details in game_config.Units.items() %}
            {% if details.building_source == "Stables" %}
              {% set curr_level = player_data.Units.levels[unit] %}
              {% set upgrade_cost = [] %}
              {% for resource, cost in details.cost.items() %}
                {% set new_cost = cost * (game_config.game_speed_and_multiplier.unit_upgrade_cost_multiplier ** (curr_level - 1)) %}
                {% set rounded_cost = new_cost | round(method='ceil') | int %}
                {% set _ = upgrade_cost.append(resource ~ ": " ~ rounded_cost) %}
              {% endfor %}
              <option value="{{ unit }}">
                {{ unit }} - {{ upgrade_cost | join(", ") }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <button name="purchase_unit" type="submit">Purchase Unit</button>
      </form>
      {% for unit, details in game_config.Units.items() %}
        {% if details.building_source == "Stables" %}
          {% set ongoing = None %}
          {% for rec in player_data.Units.ongoing_recruitments %}
            {% if rec.unit == unit %}{% set ongoing = rec.progress %}{% endif %}
          {% endfor %}
          {% set queued = 0 %}
          {% for rec in player_data.Units.queued_recruitments %}
            {% if rec.unit == unit %}{% set queued = queued + 1 %}{% endif %}
          {% endfor %}
          {% if ongoing is not none %}
            <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
              <div class="progress-bar" style="background-color: green; width: {{ ongoing * 100 }}%; height: 100%; position: absolute;"></div>
              <div style="position: absolute; width: 100%; text-align: center; color: white;">
                {{ queued + 1 }} {{ unit }} ‚Äì {{ "%.0f"|format(ongoing * 100) }}%
              </div>
            </div>
            <br>
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}

    <!-- Dock Training Section -->
    {% if player_data.Buildings.levels.Dock > 0 %}
      <h2>‚õµ Dock: Level {{ player_data.Buildings.levels.Dock }}</h2>
      <h5>{{ game_config.Buildings.Dock.description }}</h5>
      <p>üö¢ Ships: {{ player_data.Units.count.Boat }}</p>
      <h3>üö¢ Ship Yard</h3>
      <form method="POST">
        <select name="unit_type">
          {% for unit, details in game_config.Units.items() %}
            {% if details.building_source == "Dock" %}
              {% set curr_level = player_data.Units.levels[unit] %}
              {% set upgrade_cost = [] %}
              {% for resource, cost in details.cost.items() %}
                {% set new_cost = cost * (game_config.game_speed_and_multiplier.unit_upgrade_cost_multiplier ** curr_level) %}
                {% set rounded_cost = new_cost | round(method='ceil') | int %}
                {% set _ = upgrade_cost.append(resource ~ ": " ~ rounded_cost) %}
              {% endfor %}
              <option value="{{ unit }}">
                {{ unit }} - {{ upgrade_cost | join(", ") }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <button name="purchase_unit" type="submit">Purchase Unit</button>
      </form>
      {% for unit, details in game_config.Units.items() %}
        {% if details.building_source == "Dock" %}
          {% set ongoing = None %}
          {% for rec in player_data.Units.ongoing_recruitments %}
            {% if rec.unit == unit %}{% set ongoing = rec.progress %}{% endif %}
          {% endfor %}
          {% set queued = 0 %}
          {% for rec in player_data.Units.queued_recruitments %}
            {% if rec.unit == unit %}{% set queued = queued + 1 %}{% endif %}
          {% endfor %}
          {% if ongoing is not none %}
            <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
              <div class="progress-bar" style="background-color: green; width: {{ ongoing * 100 }}%; height: 100%; position: absolute;"></div>
              <div style="position: absolute; width: 100%; text-align: center; color: white;">
                {{ queued + 1 }} {{ unit }} ‚Äì {{ "%.0f"|format(ongoing * 100) }}%
              </div>
            </div>
            <br>
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}

    <!-- Production Buildings (Lumber Mill, Quarry, Mines, Farm) -->
    {% if player_data.Buildings.levels["Lumber Mill"] > 0 %}
    <h2>üå≤ Lumber Mill: Level {{ player_data.Buildings.levels["Lumber Mill"] }}</h2>
    <h5>{{ game_config.Buildings["Lumber Mill"].description }}</h5>
    <p>ü™µ Wood: {{ "%.0f"|format(player_data.Resources.wood) }}</p>

    {# Filter the ongoing_resources_collection for Lumber Mill tasks #}
    {% set lumber_tasks = player_data.Buildings.ongoing_resources_collection 
        | selectattr("building", "equalto", "Lumber Mill") | list %}
    <p>ü™ì Woodcutters: {{ lumber_tasks|length > 0 
            and lumber_tasks|sum(attribute='number_of_workers') or 0 }}</p>

    {# Loop over each ongoing task for Lumber Mill (if any) #}
    {% if lumber_tasks|length > 0 %}
        {% for task in lumber_tasks %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
            <div class="progress-bar" style="background-color: green; width: {{ task.progress * 100 }}%; height: 100%; position: absolute;"></div>
            <div style="position: absolute; width: 100%; text-align: center; color: white;">
            {{ "%.0f"|format(task.progress * 100) }}%
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
        <div class="progress-bar" style="background-color: green; width: 0%; height: 100%; position: absolute;"></div>
        <div style="position: absolute; width: 100%; text-align: center; color: white;">0%</div>
        </div>
    {% endif %}

    <form method="POST">
        <input type="hidden" name="building_type" value="Lumber Mill">
        <button name="add_worker" type="submit">Add Woodcutter</button>
        <button name="remove_worker" type="submit">Remove Woodcutter</button>
    </form>
    {% endif %}



    <!-- Lumber Mill -->
    {% if player_data.Buildings.levels["Lumber Mill"] > 0 %}
    <h2>üå≤ Lumber Mill: Level {{ player_data.Buildings.levels["Lumber Mill"] }}</h2>
    <h5>{{ game_config.Buildings["Lumber Mill"].description }}</h5>
    <p>ü™µ Wood: {{ "%.0f"|format(player_data.Resources.wood) }}</p>
    {% set lumber_tasks = player_data.Buildings.ongoing_resources_collection | selectattr("building", "equalto", "Lumber Mill") | list %}
    <p>ü™ì Woodcutters: {{ lumber_tasks|length > 0 and lumber_tasks|sum(attribute='number_of_workers') or 0 }}</p>
    {% if lumber_tasks|length > 0 %}
        {% for task in lumber_tasks %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
            <div class="progress-bar" style="background-color: green; width: {{ task.progress * 100 }}%; height: 100%; position: absolute;"></div>
            <div style="position: absolute; width: 100%; text-align: center; color: white;">
            {{ "%.0f"|format(task.progress * 100) }}%
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
        <div class="progress-bar" style="background-color: green; width: 0%; height: 100%; position: absolute;"></div>
        <div style="position: absolute; width: 100%; text-align: center; color: white;">0%</div>
        </div>
    {% endif %}
    <form method="POST">
        <input type="hidden" name="building_type" value="Lumber Mill">
        <button name="add_worker" type="submit">Add Woodcutter</button>
        <button name="remove_worker" type="submit">Remove Woodcutter</button>
    </form>
    {% endif %}

    <!-- Quarry -->
    {% if player_data.Buildings.levels["Quarry"] > 0 %}
    <h2>‚õèÔ∏è Quarry: Level {{ player_data.Buildings.levels["Quarry"] }}</h2>
    <h5>{{ game_config.Buildings["Quarry"].description }}</h5>
    <p>‚õèÔ∏è Stone: {{ "%.0f"|format(player_data.Resources.stone) }}</p>
    {% set quarry_tasks = player_data.Buildings.ongoing_resources_collection | selectattr("building", "equalto", "Quarry") | list %}
    <p>‚õèÔ∏è Stone Miners: {{ quarry_tasks|length > 0 and quarry_tasks|sum(attribute='number_of_workers') or 0 }}</p>
    {% if quarry_tasks|length > 0 %}
        {% for task in quarry_tasks %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
            <div class="progress-bar" style="background-color: green; width: {{ task.progress * 100 }}%; height: 100%; position: absolute;"></div>
            <div style="position: absolute; width: 100%; text-align: center; color: white;">
            {{ "%.0f"|format(task.progress * 100) }}%
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
        <div class="progress-bar" style="background-color: green; width: 0%; height: 100%; position: absolute;"></div>
        <div style="position: absolute; width: 100%; text-align: center; color: white;">0%</div>
        </div>
    {% endif %}
    <form method="POST">
        <input type="hidden" name="building_type" value="Quarry">
        <button name="add_worker" type="submit">Add Stone Miner</button>
        <button name="remove_worker" type="submit">Remove Stone Miner</button>
    </form>
    {% endif %}

    <!-- Mines -->
    {% if player_data.Buildings.levels["Mines"] > 0 %}
    <h2>‚õèÔ∏è Mine: Level {{ player_data.Buildings.levels["Mines"] }}</h2>
    <h5>{{ game_config.Buildings["Mines"].description }}</h5>
    <p>üîó Iron: {{ "%.0f"|format(player_data.Resources.iron) }}</p>
    <p>ü™ô Gold: {{ "%.0f"|format(player_data.Resources.gold) }}</p>
    <p>üíé Diamonds: {{ "%.0f"|format(player_data.Resources.diamond) }}</p>
    {% set mines_tasks = player_data.Buildings.ongoing_resources_collection | selectattr("building", "equalto", "Mines") | list %}
    <p>‚õèÔ∏è Miners: {{ mines_tasks|length > 0 and mines_tasks|sum(attribute='number_of_workers') or 0 }}</p>
    {% if mines_tasks|length > 0 %}
        {% for task in mines_tasks %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
            <div class="progress-bar" style="background-color: green; width: {{ task.progress * 100 }}%; height: 100%; position: absolute;"></div>
            <div style="position: absolute; width: 100%; text-align: center; color: white;">
            {{ "%.0f"|format(task.progress * 100) }}%
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
        <div class="progress-bar" style="background-color: green; width: 0%; height: 100%; position: absolute;"></div>
        <div style="position: absolute; width: 100%; text-align: center; color: white;">0%</div>
        </div>
    {% endif %}
    <form method="POST">
        <input type="hidden" name="building_type" value="Mines">
        <button name="add_worker" type="submit">Add Miner</button>
        <button name="remove_worker" type="submit">Remove Miner</button>
    </form>
    {% endif %}

    <!-- Farm -->
    {% if player_data.Buildings.levels["Farm"] > 0 %}
    <h2>üöú Farm: Level {{ player_data.Buildings.levels["Farm"] }}</h2>
    <h5>{{ game_config.Buildings["Farm"].description }}</h5>
    <p>üåæ Hay: {{ "%.0f"|format(player_data.Resources.hay) }}</p>
    {% set farm_tasks = player_data.Buildings.ongoing_resources_collection | selectattr("building", "equalto", "Farm") | list %}
    <p>üöú Farmers: {{ farm_tasks|length > 0 and farm_tasks|sum(attribute='number_of_workers') or 0 }}</p>
    {% if farm_tasks|length > 0 %}
        {% for task in farm_tasks %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
            <div class="progress-bar" style="background-color: green; width: {{ task.progress * 100 }}%; height: 100%; position: absolute;"></div>
            <div style="position: absolute; width: 100%; text-align: center; color: white;">
            {{ "%.0f"|format(task.progress * 100) }}%
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="progress-container" style="background-color: grey; width: 200pt; height: 20px; position: relative;">
        <div class="progress-bar" style="background-color: green; width: 0%; height: 100%; position: absolute;"></div>
        <div style="position: absolute; width: 100%; text-align: center; color: white;">0%</div>
        </div>
    {% endif %}
    <form method="POST">
        <input type="hidden" name="building_type" value="Farm">
        <button name="add_worker" type="submit">Add Farmer</button>
        <button name="remove_worker" type="submit">Remove Farmer</button>
    </form>
    {% endif %}

    <!-- Trades Section (example shown for Market) -->
    {% if player_data.Buildings.levels["Market"] > 0 %}
      <h2>üîÑ Market: Level {{ player_data.Buildings.levels["Market"] }}</h2>
      <h5>{{ game_config.Buildings["Market"].description }}</h5>
      <div>
        {% for trade in trades %}
          <div style="border: 1px solid; margin: 5px; padding: 5px; width: 300pt;">
            <p>Trade Offer by {{ trade.source_player }}</p>
            <p>Cost:
              {% for resource, amount in trade.resources_cost.items() %}
                {{ resource }}: {{ amount }}{% if not loop.last %}, {% endif %}
              {% endfor %}
            </p>
            <p>Earn:
              {% for resource, amount in trade.resources_earned.items() %}
                {{ resource }}: {{ amount }}{% if not loop.last %}, {% endif %}
              {% endfor %}
            </p>
            {% if trade.source_player == player_data["Player Name"] %}
              <form method="POST">
                <input type="hidden" name="trade_index" value="{{ loop.index0 }}">
                <button name="remove_trade_offer" type="submit">Remove Trade Offer</button>
              </form>
            {% else %}
              <form method="POST">
                <input type="hidden" name="trade_index" value="{{ loop.index0 }}">
                <button name="accept_trade_offer" type="submit">Make Trade</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
      </div>
      <!-- Create New Trade -->
      <div style="margin-top: 20px; border: 1px solid; padding: 10px; width: 300pt;">
        <h3>Create New Trade</h3>
        <form method="POST">
          <label for="resources_cost">Resource Cost:</label>
          <select name="resources_cost">
            {% for resource in player_data.Resources.keys() %}
              <option value="{{ resource }}">{{ resource }}</option>
            {% endfor %}
          </select>
          <input type="number" name="cost_amount" min="1">
          <label for="resources_earned">Resource Earned:</label>
          <select name="resources_earned">
            {% for resource in player_data.Resources.keys() %}
              <option value="{{ resource }}">{{ resource }}</option>
            {% endfor %}
          </select>
          <input type="number" name="earned_amount" min="1">
          <button name="add_trade_offer" type="submit">Create Trade</button>
        </form>
      </div>
    {% endif %}

    <!-- Quests Section -->
    <h2>üìú Quests</h2>
    <div>
      {% for quest in quests %}
        <div style="border: 1px solid; margin: 5px; padding: 5px; width: 400pt; background-color: {{ quest.completed and 'green' or 'white' }};">
          <p>{{ quest.description }}</p>
          <p>Reward:
            {% for resource, amount in quest.reward.items() %}
              {{ resource }}: {{ amount }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </p>
          <p>Status: {{ quest.completed and "Completed" or "In Progress" }}</p>
        </div>
      {% endfor %}
    </div>

    <!-- Game-rendered image and buildings -->
    <div id="game-container" style="background-image: url('{{ url_for('static', filename=render_data.main_image) }}');">
      {% for building in render_data.buildings %}
        <img class="building" src="{{ url_for('static', filename=building.path) }}" 
             style="left: {{ building.x }}px; top: {{ building.y }}px; transform: scale({{ building.scale }});">
      {% endfor %}
    </div>

  </body>
</html>
